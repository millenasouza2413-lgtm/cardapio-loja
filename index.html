<!doctype html>
<html lang="pt-BR">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Doce Confete ‚Äî Card√°pio</title>

<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&family=Baloo+2:wght@400;700;800&display=swap" rel="stylesheet">

<style>
:root{
    --bg: #FFF9ED;
    --pastel-yellow: #FFEC8B;
    --brand-yellow: #FFC125;
    --brown-dark: #5b220f;
    --brown-mid: #9d603b;
    --accent: #e5712a;
    --card-radius: 14px;
    --shadow: 0 12px 30px rgba(91,34,15,0.08);
}
*{box-sizing:border-box}
html,body{height:100%}
body{
    margin:0;
    background: linear-gradient(180deg, var(--bg) 0%, #FFFDF8 100%);
    font-family: "Inter", system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
    color:var(--brown-dark);
    padding-bottom:60px;
}

/* header */
.header{
    position:sticky; top:0; z-index:30;
    background: linear-gradient(90deg, var(--pastel-yellow), #FFF6D6);
    padding:16px;
    border-bottom:1px solid rgba(0,0,0,0.04);
    display:flex; justify-content:space-between; align-items:center;
}
.brand{ display:flex; gap:12px; align-items:center;}
.logo{
    display:flex; gap:12px; align-items:center;
    background:linear-gradient(180deg,var(--brand-yellow), #FFB83A);
    padding:10px 14px; border-radius:12px; color:var(--brown-dark);
    font-family: "Baloo 2", cursive; font-weight:800;
    box-shadow:var(--shadow);
}
.logo img{ height:44px; width:44px; display:block; border-radius:8px; object-fit:cover; border:2px solid rgba(255,255,255,0.45) }
.tagline{ font-size:13px; color:#6b4a3b; margin-top:2px; }

.contact{ display:flex; gap:8px; align-items:center }
.contact a{ text-decoration:none; color:var(--brown-dark); background:rgba(0,0,0,0.03); padding:8px 10px; border-radius:10px; font-size:13px }

/* layout */
.wrap{ max-width:1150px; margin:20px auto; padding:16px; display:grid; grid-template-columns:1fr 360px; gap:20px; }
@media(max-width:980px){ .wrap{ grid-template-columns:1fr; padding:12px } }

/* section & cards */
.section{ background:white; border-radius:var(--card-radius); padding:16px; box-shadow:var(--shadow); border-top:6px solid var(--pastel-yellow) }
.section h2{ margin:0 0 6px 0; font-family:"Baloo 2", cursive; color:var(--brown-dark) }
.muted{ color:#6b4a3b; font-size:14px }

.product-grid{ display:grid; grid-template-columns: repeat(auto-fill, minmax(240px,1fr)); gap:14px; margin-top:12px }

.product{ border-radius:12px; overflow:hidden; background: linear-gradient(180deg,#fff,#FFFDFB); border:1px solid rgba(0,0,0,0.04); display:flex; flex-direction:column; transition:transform .14s }
.product:hover{ transform:translateY(-6px) }

/* MEDIA: imagem agora preenche o quadrado com est√©tica */
.media{
    aspect-ratio: 1 / 1;
    min-height:180px;
    display:flex; align-items:center; justify-content:center;
    background:var(--pastel-yellow);
    padding:12px; /* cria "moldura" amarela */
}
.media .img-frame{
    width:100%; height:100%; border-radius:12px; overflow:hidden;
    box-shadow: 0 8px 18px rgba(91,34,15,0.06);
    border: 6px solid rgba(255,255,255,0.6); /* leve borda branca para destacar */
    background: #fff;
}
.media img{ width:100%; height:100%; object-fit:cover; display:block; }

/* info */
.info{ padding:12px; display:flex; flex-direction:column; gap:8px }
.title{ font-weight:700; color:var(--brown-dark) }
.desc{ font-size:13px; color:#7a5a4a }
.price-row{ display:flex; justify-content:space-between; align-items:center }
.price{ font-weight:800; color:var(--brand-yellow); font-size:18px }
.old-price{ text-decoration:line-through; color:#B0896B; font-size:13px }

.controls{ display:flex; gap:8px; align-items:center; margin-top:6px }
.qty{ display:flex; align-items:center; gap:8px; background:#fff; border-radius:10px; padding:6px; border:1px solid rgba(0,0,0,0.06) }
.qty button{ border:0; background:transparent; font-weight:700; color:var(--brown-dark); cursor:pointer; width:28px; height:28px }
.qty .val{ min-width:24px; text-align:center; font-weight:700 }

/* Add button disabled style */
.btn{ background: linear-gradient(180deg, var(--brown-mid), var(--brown-dark)); color:white; padding:8px 12px; border-radius:10px; border:0; cursor:pointer; font-weight:700; font-size:14px }
.btn[disabled]{ opacity:0.45; cursor:not-allowed; transform:none }

/* flavors */
.flavors{ display:flex; flex-wrap:wrap; gap:8px; margin-top:8px }
.flavor{ background:#fff; padding:6px 10px; border-radius:20px; border:1px solid rgba(0,0,0,0.04); cursor:pointer; font-size:13px }
.flavor.selected{ background: var(--brand-yellow); color:var(--brown-dark); font-weight:700 }

/* cart sidebar */
.cart{ position:sticky; top:90px }
.box{ background:white; border-radius:12px; padding:16px; box-shadow:var(--shadow); border-top:6px solid var(--pastel-yellow) }
.cart h3{ margin:0 0 8px 0; font-family:"Baloo 2", cursive; color:var(--brown-dark) }
.cart-items{ max-height:320px; overflow:auto; margin-top:8px; display:flex; flex-direction:column; gap:10px }
.cart-item{ display:flex; justify-content:space-between; gap:8px; align-items:center; border-bottom:1px dashed rgba(0,0,0,0.04); padding-bottom:8px }
.cart-total{ display:flex; justify-content:space-between; align-items:center; margin-top:12px; font-weight:800; color:var(--brown-dark); font-size:18px }

.checkout{ margin-top:12px; display:flex; gap:8px }
.whatsapp-btn{ background: linear-gradient(90deg,#25D366,#1DA851); color:white; padding:10px 12px; border-radius:12px; border:0; cursor:pointer; font-weight:700; display:flex; gap:8px; align-items:center; flex:1; justify-content:center }
.checkout-secondary{ background:var(--brand-yellow); color:var(--brown-dark); padding:10px 12px; border-radius:12px; font-weight:700; border:0; cursor:pointer; flex:1 }

/* info pills */
.info-grid{ display:grid; grid-template-columns: repeat(auto-fit,minmax(200px,1fr)); gap:12px; margin-top:10px }
.pill{ background:#FFF8E6; border-radius:10px; padding:10px; border:1px solid rgba(0,0,0,0.02) }

/* modal */
.modal{ display:none; position:fixed; inset:0; background:rgba(0,0,0,0.45); z-index:60; align-items:center; justify-content:center; padding:18px }
.modal .card{ width:100%; max-width:620px; border-radius:12px; padding:18px; background:white }

/* flavor modal chips */
.chips{ display:flex; flex-wrap:wrap; gap:8px; margin-top:10px }
.chip{ padding:8px 12px; border-radius:999px; border:1px solid rgba(0,0,0,0.06); cursor:pointer; background:#fff }
.chip.selected{ background:var(--brand-yellow); color:var(--brown-dark); font-weight:700 }

/* tiny */
.promo-badge{ background:var(--accent); color:white; font-weight:800; padding:4px 8px; border-radius:8px; font-size:12px }
.empty{ text-align:center; color:#bda08a; padding:28px 12px }

/* small helpers */
.btn-light{ background:rgba(0,0,0,0.05); color:var(--brown-dark); padding:8px 10px; border-radius:8px; border:0; font-weight:700 }
.active{ box-shadow:inset 0 -3px 0 rgba(0,0,0,0.04) }
</style>
</head>
<body>

<header class="header">
    <div class="brand">
        <div class="logo">
            <!-- logo image (se n√£o carregar, mostra somente texto) -->
            <img src="" alt="logo" id="logo-img">
            <div style="display:flex;flex-direction:column;">
                <div style="display:flex;align-items:center;gap:8px;">
                    <span style="font-size:18px">üéâ</span>
                    <div>Doce Confete</div>
                </div>
                <div class="tagline">doces & salgados!</div>
            </div>
        </div>
    </div>

    <div class="contact">
        <a href="tel:558791060340">üìû (87) 9106-0340</a>
        <a id="wa-link" href="https://wa.me/558791060340" target="_blank">üí¨ WhatsApp</a>
    </div>
</header>

<main class="wrap">
    <div>
        <div class="section">
            <h2>üçï Salgados</h2>
            <div class="muted">Escolha o produto ‚Äî depois escolha sabores ao adicionar</div>
            <div id="salgados" class="product-grid"></div>
        </div>

        <div class="section" style="margin-top:16px;">
            <h2>üç¨ Doces</h2>
            <div class="muted">Ao clicar em "Adicionar" escolha os sabores</div>
            <div id="doces" class="product-grid"></div>
        </div>

        <div class="section" style="margin-top:16px;">
            <h2>üéÅ Kits e Combos</h2>
            <div class="muted">Kits para festas ‚Äî escolha e adicione</div>
            <div id="combos" class="product-grid"></div>
        </div>

        <div class="section" style="margin-top:16px;">
            <h2>üç© Mini Churros</h2>
            <div id="churros" class="product-grid"></div>
        </div>

        <div class="section" style="margin-top:16px;">
            <h2>‚ÑπÔ∏è Informa√ß√µes importantes</h2>
            <div class="info-grid">
                <div class="pill">
                    <strong>‚è∞ Hor√°rio</strong>
                    <p style="margin:6px 0 0 0; font-size:14px; color:#6b4a3b">
                        Trabalhamos de domingo a domingo.<br>
                        Segunda a s√°bado:<br>
                        ‚Ä¢ 10:00 ‚Äì 12:00 (manh√£: retirada/entrega de encomendas)<br>
                        ‚Ä¢ 14:00 ‚Äì 18:00 (aberto ao p√∫blico)<br>
                        Domingo: 08:00 ‚Äì 10:00
                    </p>
                </div>

                <div class="pill">
                    <strong>üöö Entrega</strong>
                    <p style="margin:6px 0 0 0; font-size:14px; color:#6b4a3b">
                        A entrega depende do bairro/regi√£o de Caruaru ‚Äî o valor ser√° informado no chat.
                    </p>
                </div>

                <div class="pill">
                    <strong>üí≥ Pagamento</strong>
                    <p style="margin:6px 0 0 0; font-size:14px; color:#6b4a3b">
                        PIX, Cart√£o e Dinheiro.
                    </p>
                </div>
            </div>
        </div>
    </div>

    <aside class="cart">
        <div class="box">
            <h3>üõí Seu Pedido</h3>
            <div id="cart-items" class="cart-items">
                <div class="empty">Seu carrinho est√° vazio. Adicione algo gostoso! üòã</div>
            </div>

            <div class="cart-total" id="cart-total">Total: R$ 0,00</div>

            <div class="checkout">
                <button id="open-checkout" class="checkout-secondary">Finalizar</button>
                <button id="whatsapp-quick" class="whatsapp-btn">üí¨ Enviar WhatsApp</button>
            </div>

            <div style="margin-top:12px; font-size:13px; color:#7a5a4a">
                <strong>Observa√ß√µes:</strong>
                <p style="margin:6px 0 0 0">Endere√ßo e agendamento s√£o solicitados na finaliza√ß√£o.</p>
            </div>
        </div>
    </aside>
</main>

<footer style="text-align:center;color:#6b4a3b;padding:18px 12px;">¬© Doce Confete ‚Äî (87) 9106-0340 ‚Ä¢ Instagram: doc_confete </footer>

<!-- MODAL GERAL -->
<div id="modal" class="modal" aria-hidden="true">
    <div class="card">
        <!-- content trocado dinamicamente -->
        <div id="modal-body"></div>
    </div>
</div>

<script>
/* ====== Ajuste a baseImage se as imagens estiverem em outro lugar ====== */
const baseImage = 'https://doc-confete.github.io/cardapio-loja/'; // ou '' se usar paths relativos

/* Se true => usa emojis na mensagem enviada ao WhatsApp (pode causar inconsist√™ncias em alguns celulares).
   Se false => usa texto simples (recomendado para compatibilidade com iPhone). */
const useEmojiInMessage = false;

/* === dados === */
const produtosData = [
  {id:'p25',nome:'25 Salgados',preco:20.00, img:'images/25-salgados.jpg', categoria:'salgado'},
  {id:'p50',nome:'50 Salgados (Meio Cento)',preco:30.00, img:'images/50-salgados.jpg', categoria:'salgado'},
  {id:'p100',nome:'100 Salgados (Cento)',preco:50.00, precoOriginal:60.00, img:'images/100-salgados.jpg', categoria:'salgado', promo:true}
];

const docesData = [
  {id:'d40',nome:'40 Doces',preco:40.00,img:'images/40-doces.jpg', categoria:'doce'},
  {id:'d50',nome:'50 Doces',preco:50.00,img:'images/50-doces.jpg', categoria:'doce'},
  {id:'d100',nome:'100 Doces',preco:100.00,img:'images/100-doces.jpg', categoria:'doce'}
];

const combosData = [
  { id:'combo_fome', nome:'T√¥ com Fome', preco:19.00, img:'images/combo_fome.jpg', desc:'20 salgados + 10 mini churros' },
  { id:'combo_delicia', nome:'Del√≠cia da Casa', preco:35.00, img:'images/combo_delicia.jpg', desc:'40 salgados + 10 mini churros' },
  { id:'combo_festa', nome:'Festa Total', preco:55.00, img:'images/combo_festa.jpg', desc:'100 salgados + 10 mini churros' }
];

const kitsData = [
  { id:'kit_5', nome:'Kit 5 pessoas', preco:70.00, img:'images/5-pessoas.jpg', desc:'50 salgados + 40 doces' },
  { id:'kit_10_15', nome:'Kit 10‚Äì15 pessoas', preco:100.00, img:'images/10-pessoas.jpg', desc:'100 salgados + 50 doces' },
  { id:'kit_20', nome:'Kit 20 pessoas', preco:180.00, img:'images/20-pessoas.jpg', desc:'200 salgados + 80 docinhos' },
  { id:'kit_40', nome:'Kit 40 pessoas', preco:360.00, img:'images/40-pessoas.jpg', desc:'400 salgados + 160 docinhos' },
  { id:'kit_lanche', nome:'Kit Lanche', preco:45.00, img:'images/kit-lanche.jpg', desc:'50 salgados + 15 docinhos' }
];

const miniChurrosData = [
  {id:'c10', nome:'Por√ß√£o 10 Mini Churros', preco:9.99, img:'images/mini-churros-10.jpg'},
  {id:'c50', nome:'Por√ß√£o 50 Mini Churros', preco:29.00, img:'images/mini-churros-50.jpg'},
  {id:'c100', nome:'Por√ß√£o 100 Mini Churros', preco:50.90, img:'images/mini-churros-100.jpg'},
  {id:'kit2', nome:'Kit 2 Churros Gourmet', preco:9.00, img:'images/kit-churros-2.jpg'}
];

const saboresSalgado = [ 'Coxinha','Medalh√£o de Salsicha','Pastel de Carne com A√ß√∫car','Pastel de Carne','Bolinha de Queijo','Bal√£o de Pizza','Travesseiro de Carne' ];
const saboresDoce = [ 'Ferrero Rocher','Prest√≠gio','Beijinho','Casadinho','Churros','Brigadeiro','Ninho' ];

/* === estado === */
let cart = [];
const CART_KEY = 'doce_confete_cart_v2';

/* ==== helpers ==== */
function formatPrice(v){ return v.toLocaleString('pt-BR',{ style:'currency', currency:'BRL' }) }
function saveCart(){ localStorage.setItem(CART_KEY, JSON.stringify(cart)) }
function loadCart(){ const s = localStorage.getItem(CART_KEY); if(s) cart = JSON.parse(s) }

/* === logo load (tenta imagem no repo) === */
(function loadLogo(){
    const img = document.getElementById('logo-img');
    img.src = baseImage + 'images/logo.png';
    img.onerror = function(){ this.style.display = 'none'; };
})();

/* === criar cards === */
function createProductCard(item, flavorsList = []) {
    const card = document.createElement('div');
    card.className = 'product';
    card.innerHTML = `
        <div class="media">
            <div class="img-frame">
                <img src="${baseImage + (item.img || '')}" alt="${item.nome}" onerror="this.onerror=null; this.src='${baseImage}images/placeholder.png';">
            </div>
        </div>
        <div class="info">
            <div class="title">${item.nome} ${item.promo ? '<span class="promo-badge">PROMO</span>' : ''}</div>
            <div class="desc">${item.desc ? item.desc : ''}</div>

            <div style="display:flex; justify-content:space-between; align-items:center;">
                <div>
                    <div class="price">${formatPrice(item.preco)}</div>
                    ${item.precoOriginal ? `<div class="old-price">${formatPrice(item.precoOriginal)}</div>` : ''}
                </div>
                <div style="min-width:140px;">
                    <div class="controls">
                        <div class="qty">
                            <button class="minus" aria-label="diminuir">-</button>
                            <div class="val">0</div>
                            <button class="plus" aria-label="aumentar">+</button>
                        </div>
                        <button class="btn add" disabled>Adicionar</button>
                    </div>
                </div>
            </div>

            ${flavorsList.length ? `<div class="muted" style="margin-top:8px;font-size:13px">Sabores: ser√£o escolhidos ao adicionar</div>` : ''}
        </div>
    `;

    const minus = card.querySelector('.minus');
    const plus = card.querySelector('.plus');
    const val = card.querySelector('.val');
    const addBtn = card.querySelector('.add');

    function updateAddState(){
        const v = parseInt(val.textContent);
        addBtn.disabled = v <= 0;
    }

    minus.addEventListener('click', ()=> {
        let v = parseInt(val.textContent);
        if(v > 0) v--;
        val.textContent = v;
        updateAddState();
    });
    plus.addEventListener('click', ()=> {
        let v = parseInt(val.textContent);
        if(v < 100) v++;
        val.textContent = v;
        updateAddState();
    });

    addBtn.addEventListener('click', ()=> {
        const qty = parseInt(val.textContent);
        if(qty <= 0) return;
        // se o item tem sabores, abrir modal de sele√ß√£o de sabores antes de adicionar
        if(flavorsList.length) {
            openFlavorModal(item, qty, flavorsList);
        } else {
            // adicionar direto (kits/churros)
            doAddToCart(item, qty, []);
        }
        // reset qty visual para 0
        val.textContent = '0';
        updateAddState();
    });

    return card;
}

/* montar grids */
function mountGrid(containerId, data, flavors){
    const cont = document.getElementById(containerId);
    cont.innerHTML = '';
    data.forEach(d => cont.appendChild(createProductCard(d, flavors)));
}

/* adicionar ao carrinho (interno) */
function doAddToCart(item, qty, flavors){
    const key = `${item.id}__${flavors.join('|')}`;
    const idx = cart.findIndex(ci => ci.key === key);
    if(idx > -1){
        cart[idx].quantity += qty;
    } else {
        cart.push({
            key,
            id: item.id,
            name: item.nome,
            price: item.preco,
            quantity: qty,
            flavors: flavors
        });
    }
    saveCart();
    renderCart();
    toast('‚úÖ Adicionado ao carrinho');
}

/* render cart */
function renderCart(){
    const el = document.getElementById('cart-items');
    if(!cart.length){
        el.innerHTML = `<div class="empty">Seu carrinho est√° vazio. Adicione algo gostoso! üòã</div>`;
        document.getElementById('cart-total').textContent = 'Total: R$ 0,00';
        return;
    }
    el.innerHTML = '';
    let total = 0;
    cart.forEach((it, idx) => {
        const itemTotal = it.price * it.quantity; total += itemTotal;
        const node = document.createElement('div');
        node.className = 'cart-item';
        node.innerHTML = `
            <div>
                <div style="font-weight:700">${it.name} <span style="color:#b0896b;font-weight:600">x${it.quantity}</span></div>
                ${it.flavors && it.flavors.length ? `<div style="font-size:13px;color:#7a5a4a">Sabores: ${it.flavors.join(', ')}</div>` : `<div style="font-size:13px;color:#7a5a4a">Sem sabores selecionados</div>`}
            </div>
            <div style="text-align:right">
                <div style="font-weight:800;color:var(--brand-yellow)">${formatPrice(itemTotal)}</div>
                <div style="display:flex;gap:6px;margin-top:6px;justify-content:flex-end">
                    <button data-idx="${idx}" class="btn btn-light dec">-</button>
                    <button data-idx="${idx}" class="btn btn-light inc">+</button>
                    <button data-idx="${idx}" class="btn btn-light rem">Remover</button>
                </div>
            </div>
        `;
        el.appendChild(node);
    });
    document.getElementById('cart-total').textContent = `Total: ${formatPrice(total)}`;

    // handlers
    el.querySelectorAll('.dec').forEach(b => b.addEventListener('click', e=>{
        const i = parseInt(e.currentTarget.dataset.idx);
        if(cart[i].quantity > 1) cart[i].quantity--;
        else cart.splice(i,1);
        saveCart(); renderCart();
    }));
    el.querySelectorAll('.inc').forEach(b => b.addEventListener('click', e=>{
        const i = parseInt(e.currentTarget.dataset.idx);
        cart[i].quantity++; saveCart(); renderCart();
    }));
    el.querySelectorAll('.rem').forEach(b => b.addEventListener('click', e=>{
        const i = parseInt(e.currentTarget.dataset.idx);
        cart.splice(i,1); saveCart(); renderCart();
    }));
}

/* toast */
function toast(msg){
    const el = document.createElement('div');
    el.textContent = msg;
    el.style.cssText = "position:fixed; right:18px; bottom:18px; padding:10px 14px; background:var(--brand-yellow); color:var(--brown-dark); border-radius:10px; font-weight:700; box-shadow:var(--shadow); z-index:9999;";
    document.body.appendChild(el);
    setTimeout(()=> el.remove(), 2200);
}

/* ===== Flavor modal (quando o produto tem sabores) ===== */
let pendingFlavor = null; // {item, qty, flavorsList}
function openFlavorModal(item, qty, flavorsList){
    pendingFlavor = { item, qty, flavorsList };
    const modal = document.getElementById('modal');
    const body = document.getElementById('modal-body');
    body.innerHTML = `
        <h3 style="margin:0 0 8px 0">Escolha os sabores ‚Äî ${item.nome}</h3>
        <p style="margin-top:6px;color:#6b4a3b">Selecione os sabores desejados (toque para marcar). Voc√™ pode escolher at√© ${qty} sabores por item, se quiser variedade.</p>
        <div class="chips" id="flavor-chips">
            ${flavorsList.map(f => `<div class="chip" data-flavor="${f}">${f}</div>`).join('')}
        </div>

        <div style="display:flex; gap:8px; margin-top:14px; align-items:center;">
            <div style="font-size:14px; color:#6b4a3b">Quantidade: <strong>${qty}</strong></div>
            <div style="flex:1"></div>
            <button id="cancel-flavors" class="btn btn-light">Cancelar</button>
            <button id="confirm-flavors" class="btn">Confirmar e adicionar</button>
        </div>
    `;
    // attach events
    modal.style.display = 'flex'; modal.setAttribute('aria-hidden','false');
    const chips = Array.from(document.querySelectorAll('#flavor-chips .chip'));
    chips.forEach(c => c.addEventListener('click', ()=> c.classList.toggle('selected')));

    document.getElementById('cancel-flavors').onclick = ()=> { modal.style.display='none'; pendingFlavor = null; };
    document.getElementById('confirm-flavors').onclick = ()=> {
        const selected = Array.from(document.querySelectorAll('#flavor-chips .chip.selected')).map(n => n.dataset.flavor);
        // se user n√£o selecionar nenhum, aceita vazio tamb√©m
        doAddToCart(item, qty, selected);
        modal.style.display='none'; pendingFlavor = null;
    };
}

/* ====== checkout modal (finalizar pedido) ====== */
function openCheckoutModal(){
    if(!cart.length){ toast('Adicione algo ao carrinho antes de finalizar'); return; }
    const modal = document.getElementById('modal');
    const body = document.getElementById('modal-body');
    body.innerHTML = `
        <h3 style="margin:0 0 8px 0">üìã Finalizar Pedido</h3>
        <div style="display:grid; gap:8px; margin-top:8px;">
            <label>Nome do cliente *<input id="client-name" style="width:100%; padding:10px; border-radius:8px; border:1px solid #eee; margin-top:6px" placeholder="Seu nome completo"></label>
            <label>Telefone (opcional)<input id="client-phone" style="width:100%; padding:10px; border-radius:8px; border:1px solid #eee; margin-top:6px" placeholder="(xx) xxxxx-xxxx"></label>
            <label>Retirada ou Entrega?
                <div style="display:flex; gap:8px; margin-top:6px;">
                    <button class="btn btn-light" data-type="retirada">üè† Retirada</button>
                    <button class="btn btn-light" data-type="entrega">üöö Entrega</button>
                </div>
            </label>
            <div id="address-block" style="display:none;">
                <label>Endere√ßo de entrega *<textarea id="client-address" style="width:100%; padding:10px; border-radius:8px; border:1px solid #eee;" rows="3" placeholder="Rua, n√∫mero, bairro, ponto de refer√™ncia"></textarea></label>
            </div>
            <label>Agendamento (opcional)<input id="agendamento" type="text" placeholder="Ex: 20/02/2026 ‚Äî 14:30" style="width:100%; padding:10px; border-radius:8px; border:1px solid #eee;"></label>
            <label>Forma de pagamento
                <select id="payment" style="width:100%; padding:10px; border-radius:8px; border:1px solid #eee; margin-top:6px;">
                    <option value="PIX">PIX</option>
                    <option value="Cart√£o">Cart√£o</option>
                    <option value="Dinheiro">Dinheiro</option>
                </select>
            </label>
            <label>Observa√ß√µes (opcional)<textarea id="notes" style="width:100%; padding:10px; border-radius:8px; border:1px solid #eee;" rows="2"></textarea></label>
            <div style="display:flex; gap:8px; margin-top:6px;">
                <button id="cancel-modal" class="btn btn-light" style="flex:1">Cancelar</button>
                <button id="send-order" class="btn" style="flex:2">üì§ Enviar pedido pelo WhatsApp</button>
            </div>
        </div>
    `;
    modal.style.display='flex'; modal.setAttribute('aria-hidden','false');

    // entrega/retirada btns
    document.querySelectorAll('[data-type]').forEach(btn=>{
        btn.addEventListener('click', (e)=>{
            document.querySelectorAll('[data-type]').forEach(b=>b.classList.remove('active'));
            e.currentTarget.classList.add('active');
            const t = e.currentTarget.dataset.type;
            document.getElementById('modal').dataset.type = t;
            document.getElementById('address-block').style.display = t === 'entrega' ? 'block' : 'none';
        });
    });

    document.getElementById('cancel-modal').onclick = ()=> { modal.style.display='none'; };
    document.getElementById('send-order').onclick = sendOrderWhatsApp;
}

/* build whatsapp message (sem desconto PIX) */
function generateOrderNumber(){
    const d = new Date();
    const ts = d.getFullYear().toString().slice(2) +
               String(d.getMonth()+1).padStart(2,'0') +
               String(d.getDate()).padStart(2,'0') +
               String(d.getHours()).padStart(2,'0') +
               String(d.getMinutes()).padStart(2,'0') +
               String(d.getSeconds()).padStart(2,'0');
    return 'DC-' + ts;
}

function buildWhatsAppMessage(data){
    const orderId = generateOrderNumber();
    let total = cart.reduce((s,i)=> s + i.price*i.quantity, 0);

    // Se useEmojiInMessage === false, substitu√≠mos emojis por texto simples para evitar problemas de render em alguns celulares
    const itemsHeading = useEmojiInMessage ? "üßæ ITENS:" : "ITENS:";
    const totalHeading = useEmojiInMessage ? "üí∞ TOTAL:" : "TOTAL:";
    const addressHeading = useEmojiInMessage ? "üìç Endere√ßo:" : "Endere√ßo:";
    const notesHeading = useEmojiInMessage ? "üîî Observa√ß√µes:" : "Observa√ß√µes:";
    const pedidoPara = data.type === 'entrega' ? (useEmojiInMessage ? 'ENTREGA' : 'ENTREGA') : (useEmojiInMessage ? 'RETIRADA' : 'RETIRADA');

    let message = `PEDIDO - DOCE CONFETE\nPedido n¬∫: ${orderId}\n\n`;
    message += `Cliente: ${data.name}\n`;
    if(data.phone) message += `Telefone: ${data.phone}\n`;
    message += `\n${itemsHeading}\n`;

    cart.forEach(it => {
        message += `\n‚Ä¢ ${it.name} - ${formatPrice(it.price)}\n  ${it.quantity}x = ${formatPrice(it.price * it.quantity)}\n`;
        if(it.flavors && it.flavors.length) message += `  Sabores: ${it.flavors.join(', ')}\n`;
    });

    message += `\n${totalHeading} ${formatPrice(total)}`;
    message += `\n\n${addressHeading} ${data.type === 'entrega' ? (data.address || '---') : 'Retirada no local'}`;
    if(data.schedule) message += `\nAgendamento: ${data.schedule}`;
    if(data.notes) message += `\n\n${notesHeading} ${data.notes}`;

    message += `\n\nPedido para: ${pedidoPara}`;

    // encodeURIComponent para URL
    return encodeURIComponent(message);
}

/* enviar pedido via whatsapp */
function sendOrderWhatsApp(){
    const name = document.getElementById('client-name').value.trim();
    const phone = document.getElementById('client-phone').value.trim();
    const type = document.getElementById('modal').dataset.type || 'retirada';
    const address = document.getElementById('client-address') ? document.getElementById('client-address').value.trim() : '';
    const schedule = document.getElementById('agendamento').value.trim();
    const payment = document.getElementById('payment').value;
    const notes = document.getElementById('notes').value.trim();

    if(!name){ toast('Digite o nome do cliente'); document.getElementById('client-name').focus(); return; }
    if(type === 'entrega' && !address){ toast('Digite o endere√ßo para entrega'); document.getElementById('client-address').focus(); return; }

    const data = { name, phone, type, address, schedule, payment, notes };
    const msg = buildWhatsAppMessage(data);

    const phoneTo = '558791060340';
    const url = `https://wa.me/${phoneTo}?text=${msg}`;
    window.open(url, '_blank');

    // limpa tudo
    cart = []; saveCart(); renderCart();
    document.getElementById('modal').style.display = 'none';
    document.getElementById('client-name').value = '';
    document.getElementById('client-phone').value = '';
    if(document.getElementById('client-address')) document.getElementById('client-address').value = '';
    document.getElementById('agendamento').value = '';
    document.getElementById('notes').value = '';
    toast('Pedido enviado! ‚ù§Ô∏è');
}

/* quick open modal */
document.addEventListener('DOMContentLoaded', ()=> {
    mountGrid('salgados', produtosData, saboresSalgado);
    mountGrid('doces', docesData, saboresDoce);
    mountGrid('combos', combosData.concat(kitsData), []); // combos + kits (kits sem sabores)
    mountGrid('churros', miniChurrosData, []);

    loadCart(); renderCart();

    document.getElementById('open-checkout').addEventListener('click', openCheckoutModal);
    document.getElementById('whatsapp-quick').addEventListener('click', ()=> {
        if(!cart.length){ toast('Seu carrinho est√° vazio'); return; }
        openCheckoutModal();
    });

    // fechar modal clicando fora
    document.getElementById('modal').addEventListener('click', (e)=>{
        if(e.target === e.currentTarget) e.currentTarget.style.display = 'none';
    });
});
</script>

</body>
</html>
